---
title: "Mapping Complex Family Trajectories in the Childhood Life-Course"
author: "Andreas Gustafsson"
date: \today
format: 
  pdf:
    documentclass: article
    geometry: "left=3cm, right=5cm"
    include-in-header:
      text: |
        \usepackage{booktabs} 
        \usepackage{siunitx}
        \usepackage{fontspec}
        \usepackage{ragged2e}
        \usepackage[british]{babel}
        \usepackage{setspace}
        \usepackage{hyperref}
    include-before-body:
      text: |
        \onehalfspacing
        \RaggedRight
        \hypersetup{allcolors=black}
        \tableofcontents
        \listoftables
        \listoffigures
    latex_engine: xelatex
    colorlinks: true
link-citations: yes
mainfont: "Happy Times at the IKOB New Game Plus Edition"
bibliography: "bibliography.bib"
---

```{r}
#| include: false
#| warning: false
#| echo: false

# include library and function source
library(targets)
library(fst)
library(ggplot2)
library(forcats)
library(data.table)
tar_config_set(store = "../_targets/")
knitr::opts_chunk$set(out.width="100%", dev="pdf")
```


# Introduction

**INTRODUKTIONSTEXT HÃ„R**

**SISTA STYCKET:**

The objective of this thesis is describe children's family trajectories and to classify these trajectories according to the most common types of family experiences. I will also investigate the relationship between the different family trajectory groups and mother's educational level and country of residence. This will be accomplished by generating a set of family history sequences for European children, based on the Harmonized History dataset. Analysis will be performed by an exploratory sequence cluster analysis, which will be used to create an analytical definition of the most common family trajectories of European children. As a proof-of-concept I will also use these defined trajectories to examine how childhood family trajectories are associated with the risk of nest leaving using a Cox proportional hazards regression.

<!-- # Background

We currently see that partnership unions frequently end, with 46% of unions in Sweden, 38% in Germany and 19% in Italy all having been disbanded within 10 years. In the same countries, we also see that the percentage of children experiencing parental separation by age 15 is 28% in Sweden, 18% in Germany and 12% in Italy. Of these children, the percentage having entered a stepfamily within six years is 40% for Sweden, 24% for Germany and 14% for Italy [@andersson_life-table_2017]. These illustrative numbers provide us with two important pieces of information: Firstly, that processes leading to family complexity are common in Europe and secondly, that the degree to which these processes occur differ greatly between European countries. 

Apart from these national differences, we have also seen dramatic changes over time. In particular during the latter half of the 20th century. Looking at the Crude Divorce Rate (CDR), Sweden experienced a shift from almost 0 (per 1000 persons) in the period 1920-1924 to a peak of around 3 in the late 1970's before lowering to around 2 in 2010 [@harkonen_divorce_2014]. In Southern Europe this divorce trend started later. In Spain the CDR was just over 0 up until the early 1980's before reaching similar levels as Sweden in 2010 [@harkonen_divorce_2014]. Although the timing differs the patterns are similar. Studying the phenomenon from an explicit child-centered perspective, Thomson [-@thomson_family_2014] found that the four driving processes of family complexity, births to lone mothers, separation, remarriage and multipartner fertility, were all on the rise or just recently leveled off at high levels.  The rise in divorce, among other process, have led to the proposal of competing theories which try to account for these processes. -->

# Theory and previous research 

## Life course theory 

This thesis will draw on life course theory and the discourse on family complexity as the theoretical underpinnings and research context in which the findings will be situated. According to Elder et al. [-@elder_emergence_2003], life course theory came about from a "desire to understand social pathways, their developmental effect, and their relation to personal and social-historical conditions". Since its incipience in the 1970's, the *life course* has grown from a scientific idea to a theoretical framework and even a research field in its own right. With the launch of *Advances in Life Course Research* as a quarterly journal, it was declared that the life course is coming of age [@billari_life_2009]. 

The main theoretical concepts from the mature life course research which will be used in this thesis is those of *transitions*, *trajectories*,  *pathways* and *linked lives*. *Transitions* are state changes that are discrete and time-bound [@george_sociological_1993]. These can occur in multiple domains --- such as the social, biological, or economic --- and examples include divorce, menopause or getting a driver's license. In turn, multiple transitions make up life *trajectories*. These consists of longer periods of change and stability, and although marked by a series of transitions they have a continuity of direction [@hutchison_life_2005]. A family formation trajectory by Hollywood blueprint would consist of dating followed by cohabitation and finally a wedding, marking a transition into married life. 

Just as trajectories are made up of a set of transitions, *pathways* are constituted by interlocking transitions and trajectories across time and domains [@macmillan_families_2005]. In particular, pathways are often in relation to entering and exiting social institutions such as a career or family. Although the combinatorial possibilities of transitions and trajectories are vast, the number of actualized pathways are usually limited and in relation to normative systems [@white_application_2014]. A way of thinking about pathways is that they are lived in relation to schema; that is, blueprints of culturally appropriate behavior, which are enacted more or less consciously [@sewell_theory_1992]. Schema inform individual heuristics for the temporal organization of the life course be providing a set of rules and models for how to link pathways over time [@macmillan_families_2005]. A modern Scandinavian pathway in relation to family formation would be forming a cohabiting union followed by having children, skipping the previously normative transition of marriage [@hofacker_patterns_2014]. 

Although often emphasized in the literature, the power of normative schema in shaping the individual life course has been contested [@macmillan_structure_2005]. Apart from norms, institutional and structural processes also shape lives and are able to produce homogeneity in life patterns [@marini_age_1984]. A further way of thinking about pathways, uncommited to theoretical assumptions about their generation, is simply as a set of probabilities of transitioning between different states. But rather than a set of independent probabilities, they are path dependent with a certain degree of historicity, which can give rise to common patterns in a population [@rutter_pathways_1989]. 

Finally, a central idea in the life course framework is that of *linked lives*. This concept highlights the interdependence of our lives and that transitions that occur in one persons life often entail transitions for other people [@elder_emergence_2003]. This principle has particularly been applied in studies on the family and intergenerational relations [@carvalho_family_2021]. Already in one of the first studies using a life course perspective, Elder [-@elder_children_1974] found that children's development could be impeded by the economic hardships experienced by their parents. This interdependence between parents and children, and how their social lived are intertwined, has since been explored in much depth and breadth. 

## Causes and consequences of family complexity

The second main scholarly context of this thesis is in the field of family complexity. Complexity in this domain has been defined as the combination of family structure and sibling composition during childhood [@manning_family_2014]. Where a "simple" family may be defined as a household with both parents present and a few number of full-siblings, a complex family may consists of step-parents as well as half- and step-siblings. The four main demographic drivers of complexity are birth to lone mothers, separation and divorce, repartnering, and multi-partner fertility [@thomson_family_2014]. These events are primarily driven by the adults involved but clearly have consequences for the family life of children. Thus, we see how the concepts of family complexity and linked lives are tied together.

Using data from the Survey of Income and Programme Participation (SIPP) Manning et al. [-@manning_family_2014] describe changes in family complexity for US children over the period 1996-2009. The share of children who at the time of interview were living in a complex household --- defined as living with either a step-parent, single parent, or full- or half-sibling --- increased from 30.8 to 33.6 percent. The authors found that family complexity was especially prevalent in families where neither parent had a college degree as well as for Black children. However, the steepest increase in complexity during the observation period was found among Hispanic children. Further analysis of the SIPP showed that in 2008, the income-to-needs ratio for children in complex families was 2.0, contrasted to 3.0 in simple families [@brown_family_2015]. Further, 28.3 percent of complex families received public assistance (compared to 17.4 percent of simple families), on average. This indicates that family complexity is more common in marginalized groups.

## Operationalizing family complexity over the life course

As has been outlined, the family structure of children may exhibit many different patterns and if we want to fully understand this complexity also within a life course we framework, we need to study how these patterns play out over time. Or to put it in a life course framework: how children's family structure trajectories look. One fruitful analytical method which has been used within the life course literature is sequence analysis [SA, for an overview see @liao_sequence_2022]. The foundation of SA lays is in describing temporal processes as a series of states and state changes over discrete time units (such as months or years). It thereby provides a format for describing individual life course trajectories.

A usual approach for analyzing this type of data is through the use of cluster analysis [@piccarreta_holistic_2019]. This a data-centric approach which deviates from traditional statistical methodologies in two main ways: 1) the units of analyses and 2) data assumptions. Aisenbrey and Fasang [-@aisenbrey_new_2010] show these differences by contrasting event history analysis (EHA) with SA. Where EHA studies probabilities of transitions, SA studies patterns in trajectories as their main units of analysis. And when it comes to assumption about the data, EHA assumes that the data is generated by a stochastic processes whereas the algorithmic clustering makes no assumptions about the underlying process. This also leads to differences in practice, where EHA usually employs models where included covariates are derived from theory or previous empirical research, SA relies on algorithmic clustering of the data to identify groups of interest. These clusters are formed by pattern identification between individual trajectories. These clusters are then used in two main ways: most commonly they are used as a dependent categorical variable in multinomial regression two find how other covariates predict life trajectories [@piccarreta_holistic_2019] but the clusters can also be used as predictor variables to see how life trajectories influence later life outcomes [e.g. @johnston_two_2020].

However, a fair amount of critique has been leveled against the clustering techniques employed by sequence analysis. To put this critique in methodological context, I will first outline the general steps in producing sequence analytic clusters before discussing the methodological drawbacks. The first step is to create a distance (or dissimilarity) matrix by calculating the distance between each pairwise combination of individual sequences in the data. Since the seminal work of @abbott_optimal_1986, the Optimal Matching (OM) algorithm has provided a standard way of calculating such a distance metric. The basic intuition is that we can permute a sequence by two kinds of operations to arrive at another sequence. The operations are substitutions (replacing one state by another) and insertions/deletions of states (commonly known as _indels_). In most cases, it is however not as straightforward as just summing up the number of operations needed to permute one sequence into another to get their distance. As the probability of transitions between states differ between pairs of states, or between substitution and indel operations, we need a substitution matrix which gives a cost to each possible substitution between pairs of states. We also need to assign a cost to indel operations. Thus, the OM algorithm tries to find a set of operations that optimize the cost of permuting one sequence to another. This optimized cost is used as a measure of distance. Using the finalized distance matrix, it is possible to apply a clustering algorithm to derive a set of clusters, this is commonly done through Ward's method [@aisenbrey_new_2010].

The criticism leveled towards this methods is focused on two main areas: firstly, on the perceived lack of substantial results produced by the methodology and secondly, and perhaps more importantly, on the relationship between methodological assumptions and social processes. Both @wu_comments_2000 and @levine_but_2000 criticize SA for not delivering on early promises and that substantial results and new areas of research have not been borne out of SA. As summarized in @liao_sequence_2022, there is a large variety of sociological articles being published using SA which would render that point of contention moot, but it does emphasis the importance of scrutinizing the SA methodology and if it is a valid tool for modeling or describing social processes.

@wu_comments_2000 offers a critique of SA where the most pressing is if a discrete sequence with events coupled with substitution and indel costs is a good model of life trajectories. The main problem lies in determining costs, as each cost is an assumption the researcher has to make, and that costs in the OM algorithm are symmetric. This symmetric assumption means that transition from state $s_j \rightarrow s_k$ carries the same cost as transition from $s_k \rightarrow s_j$. But the question posed by Wu, is if the transitions between social states, such as employment and employment, are symmetrical in their probabilities or not. Which would imply that sequence representation through OM is not isomorphic to the social processes they purport to represent.

[@stovel_ascription_1996]

Critique of clustering: @warren_different_2015

## Previous research on children's family sequencing

# Data and Methods

## Data

In this section I will outline the data used as well as the analytical strategy used to provide descriptive statistics on children's experiences of family transitions. The data comes from birth and union histories in the Harmonized Histories data set [@perelli-harris_harmonized_2010]. This data set is compiled from a set of national surveys, primarily the Generations and Gender Survey, but also with other nationally representative surveys on partnerships and childbearing.

I start of by excluding several countries from the dataset. Germany is excluded due to its poor family history data, the UK and USA are excluded due to oversampling respondents with low socioeconomic status. Uruguay and Kazakhstan are removed as they are neither a European or Anglo-Saxon country. The Spanish SFS in 2018 is removed due to missing survey interview month.

I then have __xx__ total observations from 15 different countries. I clean the data in several steps. I remove all men from the sample. __MOTIVATION__. Next, I remove childless women and respondents with missing birth information. I remove those where there is missing information on time of union or dissolution, overlapping relationships and those where a union dissolution is reported to have occurred before the union start.

In order to be able to analyze the trajectories from the children's lived experience I reshape the data so that each child becomes a unit of observation. At the start I have __xx__ children. I remove children with missing birth month or where the birth is reported to have occurred before the mother is born. As I want to track children's' experiences until the end of age 14, I remove those in the sample who have not turned 15 at the time of interview as well as those who left home or died before their 15^th^ birthday. In total 40,934 children remained in the sample. For a visual overview of the data funnel at each step see Figure __x__ in the Appendix. 

## Sequence generation

For each child a family history was constructed on the maternal side, which is composed of the mother's partner history during the child's first 15 years of life. In order to construct this history, a STate-Sequence format [STS, @gabadinho_analyzing_2011] is used. This means that for each month of the child's life a column is generated which is filled with values describing the mother's union status and the child's number of siblings. The process time for analysis is from birth until turning 15, with monthly precision. In STS format this is represented by 180 consecutive states, one for each month. 

Firstly, union spells were constructed. As there is no information on who is the father of the child if a mother was partnered at time of birth, that partner was assumed to be the other main parent. Then for each month, the representative state was coded as either *Single*, *Original parents* or *Step* depending on the mother's partner status. The state is coded as *Single* if the mother is not in a union during the month. It is coded as *Original parents* if the mother is still in a relationship with the same partner as at the time of birth. Finally, state state is coded as *Step* if the mother is with a different partner than at time of birth. All consecutive partners are assumed to be new, i.e. no re-partnering with a former partner is assumed to occur. I do not distinguish between opposite-sex and same-sex partnerships, and the original parents are not necessarily the same as the biological parents, but simply constitute the partnership that the child is born into. Formally, the maternal union sequence can be described as the vector $\textbf{S}$ where  

```{=tex}
\[\textbf{S} = (s_1,s_2,s_3, \cdots, s_{180}) | s_n \in \{\textrm{Original parents, Single, Step} \} \] 
```

An example sequence of a child's first year where the mother is first partnered for 2 months, then single for 7 and finally repartnered for 3 months is visible in @tbl-state-ex.

```{r}
#| echo: false
#| results: "asis"
#| label: tbl-state-ex
#| tbl-cap: "First year union state sequence example"
months <- paste0("", 1:12)
states <- c(
  "OP", "OP", "Si", "Si",
  "Si", "Si", "Si", "Si",
  "Si", "St", "St", "St"
)
knitr::kable(
  rbind(
    months,
    states
  ),
  "simple",
  row.names = FALSE
)
```

## Analysis

As a first exploratory analysis,  I draw a random sample of 10,000 individuals from the final data set and calculate a dissimilarity matrix  using an optimal matching (OM) algorithm. This algorithm works by..._explain OM_...

This dissimilarity matrix is the used to cluster the sequences, which is done using Ward's method..._explaining Ward's method_...

This allows me to visualize clusters identified in the data as a first step to understand and classify children's family trajectories. I provide a visual summary of the sequence clusters by a set of three plots for each cluster. First, a state distribution plot which shows the relative frequency of each state in the population by month. Second, a modal plot which shows the relative frequency of the most common state for each time point. Third, a medoid plot which shows the sequence which lies closest to all other sequences within the cluster. It can be seen as a "median" sequence, or as the most typical trajectory within the cluster group.

The problem with cluster analysis is... _(impossible to generalize, opaque)_...

Therefore, I use the results of the clustering algorithm to define analytical categories of family trajectories. 

As a proof of concept, I also include an analysis of the association between family taxonomy and age at nest leaving. This is done by using the defined family trajectories as the main independent variable in a Cox proportional hazards regression, also controlling for country, parity, mother's level of education, and year of birth. 

## Ethical considerations

_yadidida etik osv_

In order for the research to be both transparent and reproducible, all code for generating this thesis is available as a reproduction package at Github.^[<https://github.com/addegezon/family_complexity_in_childhood>]

# Results

Here is a descriptive table 1:

```{r table1}
#| echo: false
#| results: "asis"

tar_read(table_1)
```

Here are the visualized clusters using sequence state distribution, modal and medoid plot:

```{r complex_cluster}
#| echo: false
#| warnings: false
#| fig.height: 7
#| fig.width: 5
#| fig.cap: "Here are the complex clusters"

tar_read(p_cluster_random)
```

```{r complex_analytical}
#| echo: false
#| warnings: false
#| fig.height: 7
#| fig.width: 5
#| fig.cap: "Here are the analytical clusters"

# tar_read(p_analytical_random)
```

And now I explain what we see in these graphs.

Then the question is, how much is attributable to these other covariates?

Not much!

# Discussion

# Conclusion

# Acknowledgments

# References

::: {#refs}
:::

# Appendix